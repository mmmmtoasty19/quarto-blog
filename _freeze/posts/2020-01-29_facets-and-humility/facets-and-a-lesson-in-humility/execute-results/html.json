{
  "hash": "693d51b41d7fcb0db6e6e35bef6a5deb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Facets and a Lesson in Humility\"\nsubtitle: |\n  A look at Tableau for Healthcare Chapter 8.  Table Lens graph.\ndate: 01-29-2020\n\n---\n\nTodays post is a lesson in Facets, as well as humility.  The task this week was to replicate the graph in Chapter 8 of Tableau for Healthcare in R.  The graph in question is called a Table Lens (This is the name the book uses, however I did have trouble finding this name in Google searches), it is a collection of charts with a common theme, this time looking at countries in various WHO regions and some statistics associated with mortality as well as health expenditure.  I say this is a lesson in humiltiy as I have read through the excellent book [R for Data Science](https://r4ds.had.co.nz/), and yet the idea of faceting a ggplot graph slipped my mind.  This ended with hours of trying to find a package in R to line up graphs, and way more time then I care to admit spent on getting things prefect.  I did find such a package called cowplots, which can be found [here](https://wilkelab.org/cowplot/index.html). While this is an excellent package, its use was unecessary and I reverted back to using the excellent facet feature of GGplot, which can be seen below! ![](WHO_LIFE.png)\n\n# Load Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(magrittr) #pipes\nlibrary(ggplot2) #ploting \nlibrary(dplyr)\nlibrary(tidyr)\n```\n:::\n\n\n# Import Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds <- readxl::read_xlsx(path = \"../2020-01-04_my-start-to-r/Tableau 10 Training Practice Data.xlsx\"\n                        ,sheet = \"03 - WHO Life Expect & Mort\"\n                        )\n```\n:::\n\n\n\n# Clean Names and Transform\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvarnames <-  c(\"who_region\", \"country\", \"year\" , \"sex\" , \"life_expect_birth\" , \"neo_mort\"\n               ,\"under_five_mort\" , \"health_expenditure\")\nnames(ds) <- varnames\n\n# Order Countries based on Life Expectancy at Birth\n\nds$country <- factor(ds$country, levels = ds$country[order(ds$life_expect_birth)]) \n\n#To \"Long\" Form\n\nds1 <-  ds %>% pivot_longer(5:8)#select columns 5 throuh 8, leave new columns at default names\n\n# Set up labels for Facet, as well as function for Facet Labeller\n\nfacet_labels <-  list(\n\"life_expect_birth\"   = \"Life Expectancy at Birth \"                            \n,\"neo_mort\"           = \"Neonatal Mortality Rate\"             \n,\"under_five_mort\"    = \"Under-Five Mortality Rate\"\n,\"health_expenditure\" = \"Health Expenditure per Capita (US$)\"  )\n\nvariable_labeller <- function(variable,value){\n  return(facet_labels[value])\n}\n```\n:::\n\n\n\n# Graphs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhightlight_countries <- (c(\"Mauritania\", \"South Africa\")) \n\ng1 <-  ds1 %>% filter(who_region == \"Africa\") %>% \n  mutate(name = factor(name, levels = c(\"life_expect_birth\" , \"neo_mort\"\n               ,\"under_five_mort\" , \"health_expenditure\"))\n         ,highlight = country %in% hightlight_countries) %>% \n  ggplot(aes(x = country, y = value, fill = highlight)) +\n  geom_col(show.legend = FALSE) +\n  coord_flip() +\n  labs(\n    title = \"World Bank Life Expectancy, Neonatal & Under-Five Mortality Rates, and Health Expenditure Analysis\"\n    ,x  = NULL\n    ,y = NULL\n  ) +\n  facet_grid(~name, scales = \"free_x\",labeller = variable_labeller) +\n  theme_bw() +\n  geom_text(aes(label = round(value, 0)), hjust = 0) +\n  scale_y_continuous(expand = expand_scale(mult = c(0,0.2))) +\n  scale_fill_manual(values = c(\"TRUE\" = \"#fc8d59\", \"FALSE\" = \"#2b83ba\"))\ng1\n```\n\n::: {.cell-output-display}\n![](facets-and-a-lesson-in-humility_files/figure-html/unnamed-chunk-4-1.png){width=1152}\n:::\n:::\n\n",
    "supporting": [
      "facets-and-a-lesson-in-humility_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}